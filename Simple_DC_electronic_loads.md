本系统主要由STM32F103单片机控制、ADS1256模块、恒流模块、电压测量模块、过压保护模块、电源等模块组成。其系统总体框图如图所示：
![图片1](https://github.com/kirito-wsj/Linux.study/assets/108894598/b594e5b4-0f7b-4baa-a852-df09e16a07c7)
STM32F103单片机--->DA输出直流电压 ---> 低通滤波--->电压跟随器隔离前后级--->反馈运放 ---> 控制NMOSIRF3710开关--->mos管处于导通状态--->康铜丝将电流转化为电压信号--->ADS1256采集--->单片机显示
单片机输出3.3V或者0V（控制三极管的导通与截止）--->输出0V--->BJTSS8050--->导通Pmos管IRF4905截止---切断--->  直流电源--->反馈运放 
											---切断--->   导通Pmos管IRF4905导通

				           --->输出3.3V--->BJTSS8050导通--->导通Pmos管IRF4905导通--->分压--->电压跟随器--->ADS1256采集--->单片机显示

2.2.1　ADC的论证与选择  ADC方面需要一个足够精准的模数转换器，以减少转换中所带来的误差，且在尽可能的范围内控制成本。

2.2.2 DAC电路的论证与选择 DAC方面需要一个低功耗、单通道的数模转换器，且在可控范围内尽量降低成本。

2.2.3 MOS管的选择  选择MOS管需要关注VGS，VDS，ID, RDS(ON)等参数，还有计算导通损耗，导通电阻是会随着温度变化而变化的。本电路所用的MOS管VGS参考手册其典型值为2V,最大为4V，使用+5V供电的轨至轨芯片
OPA333即能驱动。

3.1 ADS1256的工作原理

3.2 STM32F103单片机产生DA 的工作原理
数字/模拟转换模块 输入的数字编码，转换成对应的模拟电压输出

要求：被测电源为输出电压可调的直流稳压电源，额定电压不小于30V，额定电流不小于2A。测控电路采用一路+5V电源供电。
一、总体设计图
![image](https://github.com/kirito-wsj/Linux.study/assets/108894598/20093877-a3c7-4b42-98b4-fe5b20fd6bfd)

二、电源电路

整个系统按题目要求采用单电源+5V供电，同时使用AMS1117芯片降压给单片机以及ADC供电。

三、恒流源控制电路
	外部输入电压的最大值为24V（过压保护），且最大工作电流为2A，那么NMOS所承受的功率为44W，功率电阻所承受的功率为4W，设计中选用个额定功率为4W电阻和71W的IPP180N，完全可满足功率和电流要求。同时在IPP180N上载入超大型散热片，防止过热而导致功率电阻的阻值发生变化。在工作模式时电流设置范围采用100mA~1000mA，当采样电阻R=1欧姆时，只要调整压控电压使之位于100m V-1000mV之间。就能调节输出电流大小。
 
 3.1 NMOS的选型：
因为使用增强型NMOS管作为功率器件，具有正温度系数，当结温升高时通态电阻增大，有自限流作用，所以功率MOS管热稳定性好。

3.2 是否需要升压来驱动NMOS：
IPP180N开启电压范围为2V—3.5V，按最坏的情况开启电压为3.5V，当电流输出为2A时，采样电阻电压Ur=2V，OPA333为轨至轨运放，假设输出Vomax=5V，此时Vgs=3V，因此可能无法开启。但是题目要求是从100mA-1A以100mA步进可调，因此我先降低要求，电流以1A计算，同理按上述计算Vgs=4V，加入电源轨限制因素大概率还是大于开启电压的（如果运气不是那么差的话）。

![image](https://github.com/kirito-wsj/Linux.study/assets/108894598/4b162586-943b-4cac-8709-da6f6a9f62b2)

此图为IPP180N关于Rds与Vgs的关系图，从图可知Rds很小。当待测电源输出20V/1A时：Pr=1W，Pmos=19W=I^2*Rds,得到Rds=19欧姆，是比较大的，可以预测一下Vgs的电压是比较小所以导通电阻能达到这么大。综上暂不考虑升压，但不可否认的是升压确实能提高电流的控制精度以及排除潜在的风险。

3.3 过压保护电路：

使用继电器进行隔离保护，同时使用电阻进行0.1倍分压，当单片机检测电压为2.4V时（对应24V）控制继电器断开电路连接。同时AD2测试口通过采集电阻电压来计算出流过电阻的电流。

四、ADC采集电路
